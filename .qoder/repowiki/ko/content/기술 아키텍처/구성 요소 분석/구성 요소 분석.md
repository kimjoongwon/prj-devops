# 구성 요소 분석

<cite>
**이 문서에서 참조된 파일**   
- [cert-manager/Chart.yaml](file://helm/cluster-services/cert-manager/Chart.yaml)
- [metallb/l2advertisement.yaml](file://helm/cluster-services/metallb/l2advertisement.yaml)
- [metallb/pool-1.yaml](file://helm/cluster-services/metallb/pool-1.yaml)
- [nfs-provisioner/Chart.yaml](file://helm/cluster-services/nfs-provisioner/Chart.yaml)
- [nfs-provisioner/values.yaml](file://helm/cluster-services/nfs-provisioner/values.yaml)
- [argocd/Chart.yaml](file://helm/development-tools/argocd/Chart.yaml)
- [argocd/values.yaml](file://helm/development-tools/argocd/values.yaml)
- [harbor/Chart.yaml](file://helm/development-tools/harbor/Chart.yaml)
- [harbor/values.yaml](file://helm/development-tools/harbor/values.yaml)
- [grafana/Chart.yaml](file://helm/development-tools/grafana/Chart.yaml)
- [grafana/values.yaml](file://helm/development-tools/grafana/values.yaml)
- [prometheus/Chart.yaml](file://helm/development-tools/prometheus/Chart.yaml)
- [prometheus/values.yaml](file://helm/development-tools/prometheus/values.yaml)
- [jenkins/Chart.yaml](file://helm/development-tools/jenkins/Chart.yaml)
- [jenkins/values.yaml](file://helm/development-tools/jenkins/values.yaml)
- [plate-web/Chart.yaml](file://helm/applications/plate-web/Chart.yaml)
- [plate-web/values.yaml](file://helm/applications/plate-web/values.yaml)
- [plate-api/Chart.yaml](file://helm/applications/plate-api/Chart.yaml)
- [plate-api/values.yaml](file://helm/applications/plate-api/values.yaml)
- [plate-llm/Chart.yaml](file://helm/applications/plate-llm/Chart.yaml)
- [plate-llm/values.yaml](file://helm/applications/plate-llm/values.yaml)
- [plate-cache/Chart.yaml](file://helm/applications/plate-cache/Chart.yaml)
- [plate-cache/values.yaml](file://helm/applications/plate-cache/values.yaml)
- [ingress/Chart.yaml](file://helm/ingress/Chart.yaml)
- [ingress/values.yaml](file://helm/ingress/values.yaml)
- [openbao-secrets-manager/Chart.yaml](file://helm/shared-configs/openbao-secrets-manager/Chart.yaml)
- [openbao-secrets-manager/values.yaml](file://helm/shared-configs/openbao-secrets-manager/values.yaml)
</cite>

## 목차
1. [클러스터 서비스 계층 분석](#클러스터-서비스-계층-분석)
2. [개발 도구 계층 분석](#개발-도구-계층-분석)
3. [애플리케이션 계층 분석](#애플리케이션-계층-분석)
4. [공유 구성 및 인그레스 분석](#공유-구성-및-인그레스-분석)

## 클러스터 서비스 계층 분석

prj-devops 리포지토리는 cert-manager, MetalLB, nfs-provisioner로 구성된 클러스터 서비스 계층을 통해 쿠버네티스 클러스터의 핵심 기능을 제공합니다. 이 계층은 인증서 관리, 네트워크 부하 분산, 스토리지 프로비저닝이라는 세 가지 핵심 서비스를 담당합니다.

**cert-manager**는 Let's Encrypt와 통합하여 자동화된 SSL/TLS 인증서 발급 및 갱신을 처리합니다. `helm/cluster-services/cert-manager/Chart.yaml` 파일은 이 서비스의 Helm 차트를 정의하며, `cert-manager`를 종속성으로 선언하고 있습니다. 주요 구성은 `values.yaml` 파일에 정의되어 있으며, 프로덕션과 스테이징 환경을 위한 두 개의 `ClusterIssuer`가 활성화되어 있습니다. 프로덕션 발급자는 `https://acme-v02.api.letsencrypt.org/directory`에 연결되며, 이메일 연락처는 `admin@example.com`으로 설정되어 있습니다. 이 구성은 모든 인그레스 리소스에 대해 `ingress` 기반의 `http01` 도전 방식을 사용하여 도메인 소유권을 검증합니다.

**MetalLB**는 쿠버네티스 클러스터에 온프레미스 환경에서의 `LoadBalancer` 서비스 유형을 제공하는 네트워크 부하 분산 솔루션입니다. 이 리포지토리에서는 `Layer 2` 모드로 구성되어 있으며, `helm/cluster-services/metallb/` 디렉터리 내의 YAML 파일들에 의해 정의됩니다. `pool-1.yaml` 파일은 IP 풀을 정의하여 `192.168.0.20`부터 `192.168.0.200`까지의 IP 주소 범위를 할당 대상으로 지정합니다. `l2advertisement.yaml` 파일은 이 IP 풀을 `metallb-system` 네임스페이스에 있는 `first-pool`이라는 이름으로 광고합니다. 이 설정을 통해 `LoadBalancer` 유형의 서비스가 클러스터 외부에서 접근 가능한 고정 IP를 얻을 수 있습니다.

**nfs-provisioner**는 기존의 NFS 서버를 기반으로 동적 스토리지 프로비저닝을 제공하는 구성 요소입니다. `helm/cluster-services/nfs-provisioner/Chart.yaml` 파일은 `nfs-subdir-external-provisioner` 이미지를 사용하는 Helm 차트임을 나타냅니다. `values.yaml` 파일을 통해 NFS 서버의 주소(`192.168.97`)와 내보내기 경로(`/export/k8s`)를 구성할 수 있습니다. 이 구성 요소는 `nfs-client`라는 이름의 `StorageClass`를 자동 생성하도록 설정되어 있으며, 이 클래스는 `allowVolumeExpansion: true`로 설정되어 있어 PVC의 크기를 확장할 수 있습니다. 이는 `plate-cache`와 같은 애플리케이션에서 동적 스토리지 요구 사항을 충족시키는 데 필수적인 역할을 합니다.

**Section sources**
- [cert-manager/Chart.yaml](file://helm/cluster-services/cert-manager/Chart.yaml#L1-L23)
- [cert-manager/values.yaml](file://helm/cluster-services/cert-manager/values.yaml#L1-L35)
- [metallb/l2advertisement.yaml](file://helm/cluster-services/metallb/l2advertisement.yaml#L1-L9)
- [metallb/pool-1.yaml](file://helm/cluster-services/metallb/pool-1.yaml#L1-L9)
- [nfs-provisioner/Chart.yaml](file://helm/cluster-services/nfs-provisioner/Chart.yaml#L1-L14)
- [nfs-provisioner/values.yaml](file://helm/cluster-services/nfs-provisioner/values.yaml#L1-L115)

## 개발 도구 계층 분석

prj-devops 리포지토리는 ArgoCD, Harbor, Grafana, Prometheus, Jenkins으로 구성된 강력한 개발 도구 계층을 제공하여 CI/CD 파이프라인, 컨테이너 이미지 관리, 모니터링 및 빌드 자동화를 구현합니다.

**ArgoCD**는 GitOps 기반의 지속적 배포 도구로, `helm/development-tools/argocd/Chart.yaml` 파일에 정의된 Helm 차트를 통해 배포됩니다. 이 차트는 Redis HA를 종속성으로 포함하여 고가용성을 보장합니다. `values.yaml` 파일을 통해 다양한 구성이 가능하며, `global.domain`이 `argocd.cocdev.co.kr`로 설정되어 있어 외부 접근이 가능합니다. RBAC 정책은 `policy.csv`에 정의되어 있으며, `admin` 역할은 모든 리소스에 대한 완전한 권한을 가지며, `readonly` 역할은 읽기 전용 권한을 갖습니다. 또한, `expose.type`이 `ingress`로 설정되어 있으며, `letsencrypt-prod` ClusterIssuer를 사용하여 TLS를 구성합니다.

**Harbor**는 신뢰할 수 있는 클라우드 네이티브 레지스트리로, 컨테이너 이미지를 저장, 서명 및 스캔합니다. `helm/development-tools/harbor/Chart.yaml` 파일은 이 서비스의 Helm 차트임을 나타냅니다. `values.yaml` 파일을 통해 `expose.type`이 `ingress`로 설정되어 외부 노출되며, `harbor.cocdev.co.kr` 도메인과 연결됩니다. 영구 스토리지는 `persistence` 섹션에서 활성화되며, `registry`, `jobservice`, `database` 등 각 컴포넌트에 대해 `openebs-hostpath` StorageClass를 사용하는 PVC가 생성됩니다. 이는 이미지 데이터의 지속성을 보장합니다.

**Grafana**와 **Prometheus**는 모니터링 스택을 구성합니다. Grafana는 메트릭을 시각화하는 대시보드를 제공하며, `helm/development-tools/grafana/Chart.yaml`에 정의된 차트를 통해 배포됩니다. `values.yaml` 파일에서 `ingress.enabled`가 `true`로 설정되어 `grafana.cocdev.co.kr` 도메인을 통해 접근 가능하며, `letsencrypt-prod`를 통해 TLS를 구성합니다. Prometheus는 메트릭을 수집하고 저장하는 역할을 하며, `helm/development-tools/prometheus/Chart.yaml`에 정의된 차트를 통해 배포됩니다. `values.yaml` 파일에서 `server.ingress.enabled`가 `true`로 설정되어 `prometheus.cocdev.co.kr` 도메인을 통해 접근 가능하며, `server.persistentVolume.enabled`가 `true`로 설정되어 `8Gi` 크기의 PVC를 사용하여 메트릭 데이터를 지속 저장합니다.

**Jenkins**는 전통적인 CI/CD 파이프라인을 위한 빌드 서버입니다. `helm/development-tools/jenkins/Chart.yaml` 파일은 Jenkins 컨테이너 이미지 정보를 포함합니다. `values.yaml` 파일을 통해 `controller.installPlugins` 목록을 통해 `kubernetes`, `workflow-aggregator`, `git`, `configuration-as-code` 등의 핵심 플러그인이 설치되도록 구성되어 있습니다. JCasC(Jenkins Configuration as Code)가 활성화되어 있으며, `controller.JCasC.securityRealm`을 통해 로컬 사용자 인증이 설정되고, `controller.JCasC.authorizationStrategy`를 통해 로그인한 사용자에게 모든 작업 권한이 부여됩니다. 또한, `controller.ingress.enabled`가 `true`로 설정되어 `jenkins.cocdev.co.kr` 도메인을 통해 접근 가능하며, `letsencrypt-prod`를 통해 TLS를 구성합니다.

**Section sources**
- [argocd/Chart.yaml](file://helm/development-tools/argocd/Chart.yaml#L1-L32)
- [argocd/values.yaml](file://helm/development-tools/argocd/values.yaml#L1-L800)
- [harbor/Chart.yaml](file://helm/development-tools/harbor/Chart.yaml#L1-L25)
- [harbor/values.yaml](file://helm/development-tools/harbor/values.yaml#L1-L800)
- [grafana/Chart.yaml](file://helm/development-tools/grafana/Chart.yaml#L1-L36)
- [grafana/values.yaml](file://helm/development-tools/grafana/values.yaml#L1-L800)
- [prometheus/Chart.yaml](file://helm/development-tools/prometheus/Chart.yaml#L1-L59)
- [prometheus/values.yaml](file://helm/development-tools/prometheus/values.yaml#L1-L800)
- [jenkins/Chart.yaml](file://helm/development-tools/jenkins/Chart.yaml#L1-L50)
- [jenkins/values.yaml](file://helm/development-tools/jenkins/values.yaml#L1-L800)

## 애플리케이션 계층 분석

prj-devops 리포지토리는 plate-web, plate-api, plate-llm, plate-cache로 구성된 애플리케이션 계층을 통해 핵심 비즈니스 서비스를 제공합니다. 각 애플리케이션은 독립적인 Helm 차트로 관리되며, environments 디렉터리의 ArgoCD 앱 정의를 통해 프로덕션과 스테이징 환경에 배포됩니다.

**plate-web**은 프론트엔드 웹 서비스로, `helm/applications/plate-web/Chart.yaml` 파일에 정의된 Helm 차트를 사용합니다. 이 서비스는 `nginx` 리버스 프록시와 `busybox` 기반의 간단한 백엔드로 구성됩니다. `values.yaml` 파일을 통해 `replicaCount`가 `1`로 설정되어 있으며, `ingress`를 통해 `cocdev.co.kr` 도메인의 루트 경로(`/`)에 노출됩니다. TLS는 `web-tls`라는 이름의 시크릿을 사용하며, `cert-manager.io/cluster-issuer` 어노테이션을 통해 `letsencrypt-prod` 발급자에 의해 자동으로 관리됩니다.

**plate-api**는 백엔드 API 서버로, `helm/applications/plate-api/Chart.yaml` 파일에 정의된 Helm 차트를 사용합니다. 이 서비스는 `nginx` 리버스 프록시와 사용자 정의 `kimjoongwon/server` 이미지 기반의 애플리케이션 컨테이너로 구성됩니다. `values.yaml` 파일을 통해 `replicaCount`가 `2`로 설정되어 있으며, `ingress`를 통해 `cocdev.co.kr` 도메인의 `/api` 경로에 노출됩니다. TLS는 `server-tls`라는 이름의 시크릿을 사용합니다. 중요한 점은 `appSecrets` 섹션을 통해 `app-env-secrets`라는 이름의 쿠버네티스 시크릿에서 `APP_PORT`, `DATABASE_URL`, `AUTH_JWT_SECRET` 등 다양한 환경 변수를 주입받도록 구성되어 있다는 것입니다.

**plate-llm**은 LangChain 기반의 LLM 서비스로, `helm/applications/plate-llm/Chart.yaml` 파일에 정의된 Helm 차트를 사용합니다. 이 서비스는 `harbor.cocdev.co.kr/stg-llm/server` 이미지를 사용하며, `values.yaml` 파일을 통해 `resources`가 CPU `1000m`과 메모리 `2Gi`로 설정되어 있어 상대적으로 높은 리소스 요구 사항을 가집니다. `ingress`를 통해 `llm.cocdev.co.kr` 도메인에 노출되며, `llm-tls` 시크릿을 사용하여 TLS를 구성합니다.

**plate-cache**는 컨테이너 빌드 캐시를 위한 스토리지 리소스로, `helm/applications/plate-cache/Chart.yaml` 파일에 정의된 Helm 차트를 사용합니다. 이 차트는 `pvc.yaml` 템플릿을 통해 영구 볼륨 클레임(PVC)을 생성합니다. `values.yaml` 파일을 통해 `size`가 `50Gi`로 설정되어 있으며, `openebs-single-replica` StorageClass를 사용합니다. 이 PVC는 `container-builder-pvc`라는 이름으로 생성되며, 다른 애플리케이션에서 볼륨 마운트를 통해 사용될 수 있습니다.

**Section sources**
- [plate-web/Chart.yaml](file://helm/applications/plate-web/Chart.yaml#L1-L17)
- [plate-web/values.yaml](file://helm/applications/plate-web/values.yaml#L1-L73)
- [plate-api/Chart.yaml](file://helm/applications/plate-api/Chart.yaml#L1-L16)
- [plate-api/values.yaml](file://helm/applications/plate-api/values.yaml#L1-L116)
- [plate-llm/Chart.yaml](file://helm/applications/plate-llm/Chart.yaml#L1-L19)
- [plate-llm/values.yaml](file://helm/applications/plate-llm/values.yaml#L1-L68)
- [plate-cache/Chart.yaml](file://helm/applications/plate-cache/Chart.yaml#L1-L16)
- [plate-cache/values.yaml](file://helm/applications/plate-cache/values.yaml#L1-L14)

## 공유 구성 및 인그레스 분석

prj-devops 리포지토리는 `ingress`와 `shared-configs/openbao-secrets-manager`라는 두 가지 핵심 공유 구성 요소를 통해 클러스터 전체의 일관성과 보안을 보장합니다.

**ingress** Helm 차트는 단일 인그레스 리소스를 생성하여 여러 서비스를 하나의 도메인에서 라우팅합니다. `helm/ingress/Chart.yaml` 파일은 이 차트의 메타데이터를 정의하며, `values.yaml` 파일을 통해 상세한 구성이 이루어집니다. 이 구성은 `frontend` 서비스(`plate-fe-web-prod`)와 `backend` 서비스(`plate-be-server-prod`)를 `cocdev.co.kr` 도메인으로 연결합니다. 루트 경로(`/`)는 프론트엔드 서비스로, `/api` 경로는 백엔드 서비스로 라우팅됩니다. `annotations` 섹션을 통해 `cert-manager.io/cluster-issuer`를 `letsencrypt-prod`로 설정하여 프로덕션용 TLS 인증서를 발급받으며, `ingress.kubernetes.io/ssl-redirect: "true"`를 통해 HTTP 트래픽을 HTTPS로 강제 리다이렉트합니다. 이는 단일 진입점을 통해 모든 트래픽을 안전하게 처리하는 중앙 집중식 라우팅 전략을 구현합니다.

**openbao-secrets-manager**는 OpenBao(HashiCorp Vault 오픈소스 포크)를 사용하여 외부 비밀을 쿠버네티스 시크릿으로 동기화하는 역할을 합니다. `helm/shared-configs/openbao-secrets-manager/Chart.yaml` 파일은 이 서비스의 Helm 차트를 정의하며, `external-secrets` 오퍼레이터를 종속성으로 설치합니다. `values.yaml` 파일은 핵심 구성 요소를 포함합니다. `openbao.server`는 `https://openbao.cocdev.co.kr`로 설정되어 있으며, `externalSecrets.data` 섹션은 `server/default` 경로에서 다양한 환경 변수(`APP_PORT`, `DATABASE_URL` 등)를 추출하여 `app-env-secrets`라는 이름의 쿠버네티스 시크릿으로 생성하도록 정의합니다. `environments` 섹션은 스테이징과 프로덕션 환경에 대해 각각 다른 비밀 경로(`server/staging`, `server/production`)를 사용하도록 오버라이드할 수 있도록 합니다. 또한, `harbor` 섹션은 Harbor 레지스트리 인증을 위한 별도의 비밀(`harbor-registry-secret`)을 생성하고, 이를 `harbor/staging`, `harbor/production` 등의 경로에서 가져오도록 구성합니다. 이는 민감한 인증 정보를 중앙에서 관리하고, 애플리케이션 배포 시 자동으로 주입하는 보안 모범 사례를 구현합니다.

**Section sources**
- [ingress/Chart.yaml](file://helm/ingress/Chart.yaml#L1-L15)
- [ingress/values.yaml](file://helm/ingress/values.yaml#L1-L51)
- [openbao-secrets-manager/Chart.yaml](file://helm/shared-configs/openbao-secrets-manager/Chart.yaml#L1-L25)
- [openbao-secrets-manager/values.yaml](file://helm/shared-configs/openbao-secrets-manager/values.yaml#L1-L230)