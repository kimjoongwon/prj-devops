# ClusterSecretStore - 클러스터 전역에서 사용 가능한 SecretStore
# 모든 네임스페이스의 ExternalSecret에서 참조 가능
{{- if .Values.clusterSecretStore.enabled }}
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: {{ .Values.clusterSecretStore.name }}
  labels:
    {{- include "openbao-secrets-manager.labels" . | nindent 4 }}
    app.kubernetes.io/component: cluster-secret-store
  {{- with .Values.clusterSecretStore.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  provider:
    vault:
      server: {{ .Values.openbao.server | quote }}
      path: {{ .Values.openbao.path | quote }}
      version: {{ .Values.openbao.version | quote }}
      auth:
        tokenSecretRef:
          name: {{ .Values.openbao.auth.tokenSecretRef.name | quote }}
          key: {{ .Values.openbao.auth.tokenSecretRef.key | quote }}
          # ClusterSecretStore는 토큰 시크릿이 있는 네임스페이스를 지정해야 함
          namespace: {{ .Values.clusterSecretStore.tokenNamespace | default "external-secrets" | quote }}
{{- end }}
