{{- if .Values.openbao.token.create }}
{{- range .Values.global.namespaces }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $.Values.openbao.auth.tokenSecretRef.name }}
  namespace: {{ . }}
  labels:
    {{- include "openbao-secrets-manager.labels" $ | nindent 4 }}
    app.kubernetes.io/component: openbao-token
    environment: {{ if contains "prod" . }}production{{ else if contains "stg" . }}staging{{ else }}development{{ end }}
  {{- with $.Values.openbao.token.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
data:
  {{- if $.Values.openbao.token.value }}
  {{ $.Values.openbao.auth.tokenSecretRef.key }}: {{ $.Values.openbao.token.value }}
  {{- else }}
  # Token must be provided via values or external secret management
  {{ $.Values.openbao.auth.tokenSecretRef.key }}: ""
  {{- end }}
{{- end }}
{{- end }}